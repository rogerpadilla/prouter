(function(l,h){if("function"===typeof define&&define.amd)define(["exports"],h);else if("undefined"!==typeof exports)h(exports);else{var k={};h(k);l.easyRouter=k}})(this,function(l){var h=function(d,a){if(!(d instanceof a))throw new TypeError("Cannot call a class as a function");},k=function(){function d(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,c){b&&d(a.prototype,b);
c&&d(a,c);return a}}();Object.defineProperty(l,"__esModule",{value:!0});var f="undefined"===typeof global?window:global,n=f.document,q=/\((.*?)\)/g,r=/(\(\?)?:\w+/g,s=/\*\w+/g,t=/[\-{}\[\]+?.,\\\^$|#\s]/g,u=/#(.*)$/,v=/[^\/]$/,p=/^[#\/]|\s+$/g,w=/^\/+|\/+$/g,x=/\/$/,y=/#.*$/,m=function(){function d(){h(this,d);this.started=!1;this.checkUrl=this.checkUrl.bind(this);this.handlers=[];this.evtHandlers={};this.location=f.location;this.history=f.history}k(d,[{key:"atRoot",value:function(){return this.location.pathname.replace(v,
"$&/")===this.root}},{key:"getHash",value:function(){var a=this.location.href.match(u);return a?a[1]:""}},{key:"getFragment",value:function(a,b){if(void 0===a||null===a)if(this._hasPushState||!this._wantsHashChange||b){a=f.decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(x,"");0===a.lastIndexOf(c,0)&&(a=a.slice(c.length))}else a=this.getHash();else a=f.decodeURI(a);return a.replace(p,"")}},{key:"start",value:function(a){a=void 0===a?{}:a;if(d.started)throw Error("EasyRouter.history has already been started");
d.started=!0;this.opts=a;this.opts.root=this.opts.root||"/";this.root=this.opts.root;this._wantsHashChange=!1!==this.opts.hashChange;this._wantsPushState=!!this.opts.pushState;this._hasPushState=!!(this.opts.pushState&&this.history&&this.history.pushState);a=this.getFragment();this.root=("/"+this.root+"/").replace(w,"/");this._hasPushState?f.addEventListener("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in f&&f.addEventListener("hashchange",this.checkUrl);this.fragment=a;if(this._wantsHashChange&&
this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&this.location.hash&&(this.fragment=this.getHash().replace(p,""),this.history.replaceState({},n.title,this.root+this.fragment))}if(!this.opts.silent)return this.loadUrl()}},{key:"stop",value:function(){f.removeEventListener("popstate",this.checkUrl);f.removeEventListener("hashchange",this.checkUrl);d.started=
!1}},{key:"route",value:function(a,b){this.handlers.unshift({route:a,callback:b})}},{key:"checkUrl",value:function(){if(this.getFragment()===this.fragment)return!1;this.loadUrl()}},{key:"loadUrl",value:function(a){this.fragment=this.getFragment(a);a=this.handlers.length;for(var b=void 0,c=0;c<a;c++)if(b=this.handlers[c],b.route.test(this.fragment))return b.callback(this.fragment),!0;return!1}},{key:"navigate",value:function(a,b){if(!d.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.getFragment(a||
""),e=this.root+c,c=c.replace(y,"");if(this.fragment===c)return!1;this.fragment=c;""===c&&"/"!==e&&(e=e.slice(0,-1));if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},n.title,e);else if(this._wantsHashChange)this._updateHash(c,b.replace);else return this.location.assign(e);return b.trigger?this.loadUrl(c):!1}},{key:"on",value:function(a,b){void 0===this.evtHandlers[a]&&(this.evtHandlers[a]=[]);this.evtHandlers[a].push(b);return this}},{key:"off",value:function(a,b){if(this.evtHandlers[a])for(var c=
this.evtHandlers[a],e=c.length,d=0;d<e;d++)if(c[d]===b){c.splice(d,1);0===c.length&&delete this.evtHandlers[a];break}return this}},{key:"trigger",value:function(a){var b=this.evtHandlers[a];if(void 0===b)return!1;for(var c=Array.prototype.slice.call(arguments,1),e=0,d=b.length,f=[],g=void 0;e<d;e++)g=b[e].apply(this,c),f.push(g);for(;e<d;e++)if(!1===f[e])return!1;return!0}},{key:"_updateHash",value:function(a,b){if(b){var c=this.location.href.replace(/(javascript:|#).*$/,"");this.location.replace(c+
"#"+a)}else this.location.hash="#"+a}}]);return d}(),g=function(){function d(){var a=void 0===arguments[0]?{}:arguments[0];h(this,d);this.evtHandlers={};this.opts=a;this._bindRoutes();this.opts.initialize&&this.opts.initialize.apply(this,arguments)}k(d,[{key:"route",value:function(a,b,c){var e="[object RegExp]"===Object.prototype.toString.call(a)?a:d._routeToRegExp(a);"[object Function]"===Object.prototype.toString.call(b)&&(c=b,b="");c||(c=this.opts[b]);var f=this;d.history.route(e,function(a){a=
d._extractParameters(e,a);f.execute(c,a);f.trigger.apply(f,["route:"+b].concat(a));f.trigger("route",b,a);d.history.trigger("route",f,b,a)});return this}},{key:"execute",value:function(a,b){a&&a.apply(this,b)}},{key:"navigate",value:function(a,b){d.history.navigate(a,b);return this}},{key:"_bindRoutes",value:function(){if(this.opts.routes)for(var a=Object.keys(this.opts.routes),b=a.length-1,c=void 0;0<=b;b--)c=a[b],this.route(c,this.opts.routes[c])}}],[{key:"_routeToRegExp",value:function(a){a=a.replace(t,
"\\$&").replace(q,"(?:$1)?").replace(r,function(a,c){return c?a:"([^/?]+)"}).replace(s,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}},{key:"_extractParameters",value:function(a,b){var c=a.exec(b).slice(1);return c.map(function(a,b){return b===c.length-1?a||null:a?f.decodeURIComponent(a):null})}}]);return d}();g.History=m;g.prototype.trigger=m.prototype.trigger;g.prototype.on=m.prototype.on;g.prototype.off=m.prototype.off;g.history=new g.History;l.Router=g});
