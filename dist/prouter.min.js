!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Router=t()}(this,function(e,t,r){var o="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,n=["node","hash","history"],i={mode:"node",keys:!0,root:"/",rerouting:!0},a=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,u=/\*\w+/g,c=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/.*/,h=function(){function e(){}return e._getRouteKeys=function(e){var t=e.match(/:([^\/]+)/g);if(!t)return t;for(var r=0;r<t.length;r++)t[r]=t[r].replace(/[:\(\)]/g,"");return t},e._routeToRegExp=function(e){return e=e.replace(c,"\\$&").replace(a,"(?:$1)?").replace(s,function(e,t){return t?e:"([^/?]+)"}).replace(u,"([^?]*)"),new RegExp("^"+e+"(?:\\?*([^/]*))")},e._clearSlashes=function(e){return e.replace(/\/$/,"").replace(/^\//,"")},e._extractParameters=function(e,t){var r=e.exec(t).slice(1);return r.map(function(e,t){return t===r.length-1?e||null:e?o.decodeURIComponent(e):null})},e._parseQuery=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var i=r[n].split("=");t[o.decodeURIComponent(i[0])]=o.decodeURIComponent(i[1])}return t},e._prepareArguments=function(t,r){var o={},n=t.length-1,i=t[n];if(r&&r.length>0){for(var a=0;a<r.length;a++)o[r[a]]=t[a];t[r.length]&&(o.query=e._parseQuery(t[r.length])),t=[o]}else i&&i.indexOf("=")>-1&&(t[n]=e._parseQuery(i));return t},e}(),f=function(){function e(){this._routes=[],this._options=JSON.parse(JSON.stringify(i))}return e.prototype.add=function(e,t,r){var o,n;return"function"==typeof e?(r=t,t=e,n=l):(o=h._getRouteKeys(e),n=h._routeToRegExp(e)),this._routes.push({path:n,callback:t,keys:o,alias:r&&r.alias?r.alias:e,facade:null}),this},e.prototype.remove=function(e){for(var t=this._routes.length-1;t>=0;t--){var r=this._routes[t];if(e===r.alias||e===r.callback||e.toString()===r.path.toString())this._routes.splice(t,1);else if(r._routes.length>0)for(var o=r._routes.length-1;o>=0;o--)r._routes[o].remove(e)}return this},e.prototype.check=function(e,t,r){for(var o=0;o<this._routes.length;o++){var n=this._routes[o],i=e.match(n.path);if(i){var a=h._extractParameters(n.path,e),s=this._options.keys?n.keys:null;a=h._prepareArguments(a,s);var u=e.slice(0,i[0].length)!==r.slice(0,i[0].length),c={callback:n.callback,params:a,routes:[],rootRerouting:this._options.rerouting||u};t.push(c),n.facade&&(e=e.slice(i[0].length,e.length),r=r.slice(i[0].length,r.length),n.facade.check(e,c.routes,r));break}}return t},e.prototype.drop=function(){return this._routes=[],this.config(i),this},e.prototype.config=function(e){return e&&(this._options.keys="boolean"==typeof e.keys?e.keys:this._options.keys,this._options.mode=-1!==n.indexOf(e.mode)?e.mode:this._options.mode,this._options.root=e.root?"/"+h._clearSlashes(e.root)+"/":this._options.root,this._options.rerouting="boolean"==typeof e.rerouting?e.rerouting:this._options.rerouting),this},e.prototype.to=function(t){for(var r,o=0;o<this._routes.length;o++){var n=this._routes[o];t===n.alias&&(r=n.facade,r||(r=(new e).config(this._options),n.facade=r))}return r},e}(),p=function(e){function t(e){return function(t){t===!1?(a=!0,n.navigate(i)):"string"==typeof t?n.route(t):e&&e.length&&r(e)}}function r(e){if(e)for(var r,o=0;o<e.length;o+=1){var n=e[o];n.rootRerouting&&(r=n.callback.apply(null,n.params)),t(n.routes)(r)}}var n={},i="",a=!1;return n.drop=function(){return i="",e.drop()},n.listen=function(){var e=this,t=this.getCurrent();clearInterval(this._interval),this._interval=setInterval(function(){var r=n.getCurrent();t!==r&&(t=r,e.check(e.getCurrent()))},50),o.onpopstate=function(t){null!==t.state&&void 0!==t.state&&(o.clearInterval(e._interval),e.check(e.getCurrent()))}},n.check=function(t){return r(e.check(t,[],i)),e},n.navigate=function(t){var r=e._options.mode;switch(r){case"history":o.history.pushState(null,null,e._options.root+h._clearSlashes(t));break;case"hash":o.location.href=o.location.href.replace(/#(.*)$/,"")+"#"+t;break;case"node":i=t}return e},n.route=function(t){return"node"===e._options.mode&&this.check(t),a||this.navigate(t),a=!1,e},n.config=function(t){return e.config(t)},n.to=function(t){return e.to(t)},n.add=function(t,r,o){return e.add(t,r,o)},n.remove=function(t){return e.remove(t)},n.getCurrent=function(){var t=e._options.mode,r=e._options.root,n=i;if("history"===t)n=h._clearSlashes(o.decodeURI(o.location.pathname+o.location.search)),n=n.replace(/\?(.*)$/,""),n="/"!==r?n.replace(r,""):n,n=h._clearSlashes(n);else if("hash"===t){var a=o.location.href.match(/#(.*)$/);n=a?a[1]:"",n=h._clearSlashes(n)}return n},n}(new f);return p});